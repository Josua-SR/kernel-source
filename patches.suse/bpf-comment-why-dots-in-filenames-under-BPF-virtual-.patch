From: Quentin Monnet <quentin.monnet@netronome.com>
Date: Thu, 8 Mar 2018 23:46:33 -0800
Subject: bpf: comment why dots in filenames under BPF virtual FS are not
 allowed
Patch-mainline: v4.17-rc1
Git-commit: 6d8cb045cde681e64a5ed80a2ab70be831a7f9b0
References: bsc#1109837

When pinning a file under the BPF virtual file system (traditionally
/sys/fs/bpf), using a dot in the name of the location to pin at is not
allowed. For example, trying to pin at "/sys/fs/bpf/foo.bar" will be
rejected with -EPERM.

This check was introduced at the same time as the BPF file system
itself, with commit b2197755b263 ("bpf: add support for persistent
maps/progs"). At this time, it was checked in a function called
"bpf_dname_reserved()", which made clear that using a dot was reserved
for future extensions.

This function disappeared and the check was moved elsewhere with commit
0c93b7d85d40 ("bpf: reject invalid names right in ->lookup()"), and the
meaning of the dot ban was lost.

The present commit simply adds a comment in the source to explain to the
reader that the usage of dots is reserved for future usage.

Signed-off-by: Quentin Monnet <quentin.monnet@netronome.com>
Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 kernel/bpf/inode.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/kernel/bpf/inode.c
+++ b/kernel/bpf/inode.c
@@ -188,6 +188,9 @@ static int bpf_mkobj(struct inode *dir,
 static struct dentry *
 bpf_lookup(struct inode *dir, struct dentry *dentry, unsigned flags)
 {
+	/* Dots in names (e.g. "/sys/fs/bpf/foo.bar") are reserved for future
+	 * extensions.
+	 */
 	if (strchr(dentry->d_name.name, '.'))
 		return ERR_PTR(-EPERM);
 
