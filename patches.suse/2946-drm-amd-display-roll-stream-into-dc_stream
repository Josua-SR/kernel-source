From: "Leo (Sunpeng) Li" <sunpeng.li@amd.com>
Date: Wed, 26 Jul 2017 16:13:48 -0400
Subject: drm/amd/display: Roll stream into dc_stream
Git-commit: a989ab08a7e3ee4675ea56b5dcfd0f2966aa91db
Patch-mainline: v4.15-rc1
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

Signed-off-by: Leo (Sunpeng) Li <sunpeng.li@amd.com>
Reviewed-by: Andrey Grodzovsky <Andrey.Grodzovsky@amd.com>
Acked-by: Harry Wentland <Harry.Wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/amd/display/dc/core/dc_stream.c |   29 ++++++------------------
 1 file changed, 8 insertions(+), 21 deletions(-)

--- a/drivers/gpu/drm/amd/display/dc/core/dc_stream.c
+++ b/drivers/gpu/drm/amd/display/dc/core/dc_stream.c
@@ -31,17 +31,6 @@
 #include "timing_generator.h"
 
 /*******************************************************************************
- * Private definitions
- ******************************************************************************/
-
-struct stream {
-	struct dc_stream protected;
-	int ref_count;
-};
-
-#define DC_STREAM_TO_STREAM(dc_stream) container_of(dc_stream, struct stream, protected)
-
-/*******************************************************************************
  * Private functions
  ******************************************************************************/
 
@@ -105,24 +94,22 @@ static void destruct(struct dc_stream *s
 	}
 }
 
-void dc_stream_retain(struct dc_stream *dc_stream)
+void dc_stream_retain(struct dc_stream *stream)
 {
-	struct stream *stream = DC_STREAM_TO_STREAM(dc_stream);
 
 	ASSERT(stream->ref_count > 0);
 	stream->ref_count++;
 }
 
-void dc_stream_release(struct dc_stream *public)
+void dc_stream_release(struct dc_stream *stream)
 {
-	struct stream *stream = DC_STREAM_TO_STREAM(public);
 
-	if (public != NULL) {
+	if (stream != NULL) {
 		ASSERT(stream->ref_count > 0);
 		stream->ref_count--;
 
 		if (stream->ref_count == 0) {
-			destruct(public);
+			destruct(stream);
 			dm_free(stream);
 		}
 	}
@@ -131,22 +118,22 @@ void dc_stream_release(struct dc_stream
 struct dc_stream *dc_create_stream_for_sink(
 		struct dc_sink *sink)
 {
-	struct stream *stream;
+	struct dc_stream *stream;
 
 	if (sink == NULL)
 		goto alloc_fail;
 
-	stream = dm_alloc(sizeof(struct stream));
+	stream = dm_alloc(sizeof(struct dc_stream));
 
 	if (NULL == stream)
 		goto alloc_fail;
 
-	if (false == construct(&stream->protected, sink))
+	if (false == construct(stream, sink))
 			goto construct_fail;
 
 	stream->ref_count++;
 
-	return &stream->protected;
+	return stream;
 
 construct_fail:
 	dm_free(stream);
