From: Pierre Morel <pmorel@linux.ibm.com>
Date: Mon, 23 Mar 2020 12:29:37 +0100
Subject: s390/pci: Adding bus resource
Git-commit: 65e450a9f9adabf3de1305a4c616f1313df402a3
Patch-mainline: v5.8-rc1
References: jsc#SLE-13818 bsc#1177117 LTC#186574

The current PCI implementation do not provide a bus resource.
This leads to a notice being print at boot.
Let's do it more nicely and provide the bus resource.

Signed-off-by: Pierre Morel <pmorel@linux.ibm.com>
Reviewed-by: Niklas Schnelle <schnelle@linux.ibm.com>
Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 arch/s390/include/asm/pci.h |    1 +
 arch/s390/pci/pci_bus.c     |    5 +++++
 2 files changed, 6 insertions(+)

--- a/arch/s390/include/asm/pci.h
+++ b/arch/s390/include/asm/pci.h
@@ -107,6 +107,7 @@ struct zpci_bus {
 	struct zpci_dev		*function[ZPCI_FUNCTIONS_PER_BUS];
 	struct list_head	resources;
 	struct list_head	bus_next;
+	struct resource		bus_resource;
 	int			pchid;
 	int			domain_nr;
 	enum pci_bus_speed	max_bus_speed;
--- a/arch/s390/pci/pci_bus.c
+++ b/arch/s390/pci/pci_bus.c
@@ -99,6 +99,11 @@ static struct zpci_bus *zpci_bus_alloc(i
 	kref_init(&zbus->kref);
 	INIT_LIST_HEAD(&zbus->resources);
 
+	zbus->bus_resource.start = 0;
+	zbus->bus_resource.end = ZPCI_BUS_NR;
+	zbus->bus_resource.flags = IORESOURCE_BUS;
+	pci_add_resource(&zbus->resources, &zbus->bus_resource);
+
 	return zbus;
 }
 
