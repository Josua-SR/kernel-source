From: "Rafael J. Wysocki" <rafael.j.wysocki@intel.com>
Date: Thu, 2 Jul 2020 14:14:05 +0200
Subject: ACPI: OSL: Clean up the removal of unused memory mappings
Patch-mainline: v5.9-rc1
Git-commit: 5003ad7172651e550103389b59b0dbeaebf65d00
References: jsc#SLE-16407

Fold acpi_os_map_cleanup_deferred() into acpi_os_map_remove() and
pass the latter to INIT_RCU_WORK() in acpi_os_drop_map_ref() to make
the code more straightforward.

No intentional functional impact.

Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Acked-by: Lee, Chun-Yi <jlee@suse.com>
---
 drivers/acpi/osl.c |   14 ++++++--------
 1 file changed, 6 insertions(+), 8 deletions(-)

--- a/drivers/acpi/osl.c
+++ b/drivers/acpi/osl.c
@@ -377,18 +377,16 @@ void *__ref acpi_os_map_memory(acpi_phys
 }
 EXPORT_SYMBOL_GPL(acpi_os_map_memory);
 
-static void acpi_os_map_remove(struct acpi_ioremap *map)
+static void acpi_os_map_remove(struct work_struct *work)
 {
+	struct acpi_ioremap *map = container_of(to_rcu_work(work),
+						struct acpi_ioremap,
+						track.rwork);
+
 	acpi_unmap(map->phys, map->virt);
 	kfree(map);
 }
 
-static void acpi_os_map_cleanup_deferred(struct work_struct *work)
-{
-	acpi_os_map_remove(container_of(to_rcu_work(work), struct acpi_ioremap,
-					track.rwork));
-}
-
 /* Must be called with mutex_lock(&acpi_ioremap_lock) */
 static void acpi_os_drop_map_ref(struct acpi_ioremap *map)
 {
@@ -397,7 +395,7 @@ static void acpi_os_drop_map_ref(struct
 
 	list_del_rcu(&map->list);
 
-	INIT_RCU_WORK(&map->track.rwork, acpi_os_map_cleanup_deferred);
+	INIT_RCU_WORK(&map->track.rwork, acpi_os_map_remove);
 	queue_rcu_work(system_wq, &map->track.rwork);
 }
 
