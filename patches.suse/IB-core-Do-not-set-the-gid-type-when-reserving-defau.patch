From: Parav Pandit <parav@mellanox.com>
Date: Tue, 5 Jun 2018 08:40:13 +0300
Subject: IB/core: Do not set the gid type when reserving default entries
Patch-mainline: v4.19-rc1
Git-commit: a1a4caeebac95875eaf6c8afb5a9784566484b2e
References: bsc#1103992 FATE#326009

When default GIDs are added, their gid type is set by
ib_cache_gid_set_default_gid().  There is no need to set the gid type of a
free GID entry during GID table initialization.

Signed-off-by: Parav Pandit <parav@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/infiniband/core/cache.c |    5 -----
 1 file changed, 5 deletions(-)

--- a/drivers/infiniband/core/cache.c
+++ b/drivers/infiniband/core/cache.c
@@ -792,7 +792,6 @@ static void gid_table_reserve_default(st
 	unsigned int i;
 	unsigned long roce_gid_type_mask;
 	unsigned int num_default_gids;
-	unsigned int current_gid = 0;
 
 	roce_gid_type_mask = roce_gid_type_mask_support(ib_dev, port);
 	num_default_gids = hweight_long(roce_gid_type_mask);
@@ -800,10 +799,6 @@ static void gid_table_reserve_default(st
 		struct ib_gid_table_entry *entry = &table->data_vec[i];
 
 		entry->props |= GID_TABLE_ENTRY_DEFAULT;
-		current_gid = find_next_bit(&roce_gid_type_mask,
-					    BITS_PER_LONG,
-					    current_gid);
-		entry->attr.gid_type = current_gid++;
 	}
 }
 
