From: Parav Pandit <parav@mellanox.com>
Date: Mon, 3 Sep 2018 20:20:25 +0300
Subject: RDMA/core: Replace open-coded variant of get_device
Patch-mainline: v4.20-rc1
Git-commit: 627212c9d49ba2759b699450f5d8f45f73e062fa
References: bsc#1103992 FATE#326009

Reuse existing get_device() API to do it symmetric to already used
put_device() in commit 924b8900a49d ("RDMA/core: Replace open-coded
variant of put_device")

Signed-off-by: Parav Pandit <parav@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/infiniband/core/sysfs.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/infiniband/core/sysfs.c
+++ b/drivers/infiniband/core/sysfs.c
@@ -1359,8 +1359,8 @@ void ib_device_unregister_sysfs(struct i
 {
 	int i;
 
-	/* Hold kobject until ib_dealloc_device() */
-	kobject_get(&device->dev.kobj);
+	/* Hold device until ib_dealloc_device() */
+	get_device(&device->dev);
 
 	free_port_list_attributes(device);
 
