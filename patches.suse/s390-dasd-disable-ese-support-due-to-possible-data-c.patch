From: Stefan Haberland <sth@linux.ibm.com>
Date: Mon, 20 Jan 2020 16:28:24 +0100
Subject: [PATCH] s390/dasd: disable ese support due to possible data corruption
Patch-Mainline: never, temporary fix until correct solution is in place
References: bsc#1161428

Devices are formatted in multiple of tracks.
For an enhanced space efficient (ese) volume we get errors when accessing
not formatted tracks. In this case the driver either formats the track
on the flight for write requests or returns zero data for read requests.

In case a request spans multiple tracks, the indication of an unformatted
track presented for the first track is incorrectly applied to all tracks
covered by the request. As a result, tracks containing data will be handled
as if empty, resulting in zero data being returned on read, or overwriting
existing data with zero on write.

While working on a proper fix disable the feature by always returning zero
for the ese check. This disables all ese special handling and prevents the
possible data corruption.

Fixes: 5e2b17e712cf ("s390/dasd: Add dynamic formatting support for ESE volumes")
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Acked-by: Hannes Reinecke <hare@suse.de>

---
 drivers/s390/block/dasd_eckd.c |    8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

--- a/drivers/s390/block/dasd_eckd.c
+++ b/drivers/s390/block/dasd_eckd.c
@@ -1567,9 +1567,11 @@ static int dasd_eckd_read_vol_info(struc
 
 static int dasd_eckd_is_ese(struct dasd_device *device)
 {
-	struct dasd_eckd_private *private = device->private;
-
-	return private->vsq.vol_info.ese;
+	/*
+	 * return 0 to disable ese support
+	 * this will be changed when a data integrity issue is solved
+	 */
+	return 0;
 }
 
 static int dasd_eckd_ext_pool_id(struct dasd_device *device)
