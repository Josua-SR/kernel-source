From: Christoph Hellwig <hch@lst.de>
Date: Mon, 28 Sep 2020 12:12:02 +0200
Subject: nvme: remove the 0 lba_shift check in nvme_update_ns_info
Patch-mainline: v5.10-rc1
Git-commit: 310b30e575b1e2b9a569c3582062b79c5a562fb7
References: bsc#1180197

We can no longer reach this code if Identify Namespace failed.

Signed-off-by: Christoph Hellwig <hch@lst.de>
Reviewed-by: Keith Busch <kbusch@kernel.org>
Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
Reviewed-by: Chaitanya Kulkarni <chaitanya.kulkarni@wdc.com>
Reviewed-by: Damien Le Moal <damien.lemoal@wdc.com>
Acked-by: Daniel Wagner <dwagner@suse.de>
---
 drivers/nvme/host/core.c |    6 ------
 1 file changed, 6 deletions(-)

--- a/drivers/nvme/host/core.c
+++ b/drivers/nvme/host/core.c
@@ -2129,13 +2129,7 @@ static int nvme_update_ns_info(struct nv
 	int ret;
 
 	blk_mq_freeze_queue(ns->disk->queue);
-	/*
-	 * If identify namespace failed, use default 512 byte block size so
-	 * block layer can use before failing read/write for 0 capacity.
-	 */
 	ns->lba_shift = id->lbaf[lbaf].ds;
-	if (ns->lba_shift == 0)
-		ns->lba_shift = 9;
 
 	switch (ns->head->ids.csi) {
 	case NVME_CSI_NVM:
