From: Tom St Denis <tom.stdenis@amd.com>
Date: Tue, 20 Mar 2018 09:13:08 -0400
Subject: drm/amd/amdgpu: fix offset into page with amdgpu_iomem debugfs file
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Git-commit: 864917a3b8d459ee2cfd37a1d1c9251cca88d108
Patch-mainline: v4.17-rc1
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

The offset inside the page wasn't included in the copy call meaning
the start of the page was being read/written instead.

Reported-by: Jay Cornwall <Jay.Cornwall@amd.com>
Signed-off-by: Tom St Denis <tom.stdenis@amd.com>
Reviewed-by: Christian KÃ¶nig <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_ttm.c
@@ -2022,7 +2022,7 @@ static ssize_t amdgpu_iomem_read(struct
 			return -EPERM;
 
 		ptr = kmap(p);
-		r = copy_to_user(buf, ptr, bytes);
+		r = copy_to_user(buf, ptr + off, bytes);
 		kunmap(p);
 		if (r)
 			return -EFAULT;
@@ -2066,7 +2066,7 @@ static ssize_t amdgpu_iomem_write(struct
 			return -EPERM;
 
 		ptr = kmap(p);
-		r = copy_from_user(ptr, buf, bytes);
+		r = copy_from_user(ptr + off, buf, bytes);
 		kunmap(p);
 		if (r)
 			return -EFAULT;
