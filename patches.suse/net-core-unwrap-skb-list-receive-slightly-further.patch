From: Edward Cree <ecree@solarflare.com>
Date: Mon, 2 Jul 2018 16:13:11 +0100
Subject: net: core: unwrap skb list receive slightly further
Patch-mainline: v4.19-rc1
Git-commit: 920572b73280a29e3a9f58807a8b90051b19ee60
References: bsc#1109837

Signed-off-by: Edward Cree <ecree@solarflare.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 include/trace/events/net.h |    7 +++++++
 net/core/dev.c             |    4 +++-
 2 files changed, 10 insertions(+), 1 deletion(-)

--- a/include/trace/events/net.h
+++ b/include/trace/events/net.h
@@ -222,6 +222,13 @@ DEFINE_EVENT(net_dev_rx_verbose_template
 	TP_ARGS(skb)
 );
 
+DEFINE_EVENT(net_dev_rx_verbose_template, netif_receive_skb_list_entry,
+
+	TP_PROTO(const struct sk_buff *skb),
+
+	TP_ARGS(skb)
+);
+
 DEFINE_EVENT(net_dev_rx_verbose_template, netif_rx_entry,
 
 	TP_PROTO(const struct sk_buff *skb),
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@ -4895,8 +4895,10 @@ void netif_receive_skb_list(struct list_
 {
 	struct sk_buff *skb, *next;
 
+	list_for_each_entry(skb, head, list)
+		trace_netif_receive_skb_list_entry(skb);
 	list_for_each_entry_safe(skb, next, head, list)
-		netif_receive_skb(skb);
+		netif_receive_skb_internal(skb);
 }
 EXPORT_SYMBOL(netif_receive_skb_list);
 
