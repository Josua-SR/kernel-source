From: Vitaly Kuznetsov <vkuznets@redhat.com>
Date: Tue, 8 Oct 2019 21:43:36 +0200
Subject: selftests: kvm: vmx_set_nested_state_test: don't check for VMX
 support twice
Git-commit: 700c17d9cec8712f4091692488fb63e2680f7a5d
Patch-mainline: 5.4-rc5
References: bnc#1151927 5.3.10

vmx_set_nested_state_test() checks if VMX is supported twice: in the very
beginning (and skips the whole test if it's not) and before doing
test_vmx_nested_state(). One should be enough.

Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 tools/testing/selftests/kvm/x86_64/vmx_set_nested_state_test.c |    7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)

--- a/tools/testing/selftests/kvm/x86_64/vmx_set_nested_state_test.c
+++ b/tools/testing/selftests/kvm/x86_64/vmx_set_nested_state_test.c
@@ -271,12 +271,7 @@ int main(int argc, char *argv[])
 	state.flags = KVM_STATE_NESTED_RUN_PENDING;
 	test_nested_state_expect_einval(vm, &state);
 
-	/*
-	 * TODO: When SVM support is added for KVM_SET_NESTED_STATE
-	 *       add tests here to support it like VMX.
-	 */
-	if (entry->ecx & CPUID_VMX)
-		test_vmx_nested_state(vm);
+	test_vmx_nested_state(vm);
 
 	kvm_vm_free(vm);
 	return 0;
