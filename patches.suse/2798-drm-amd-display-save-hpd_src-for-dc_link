From: Zeyu Fan <Zeyu.Fan@amd.com>
Date: Tue, 13 Jun 2017 11:54:10 -0400
Subject: drm/amd/display: Save hpd_src for dc_link
Git-commit: 7a0963345f859058fa866dd28fe13ca5eff22a87
Patch-mainline: v4.15-rc1
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

Signed-off-by: Zeyu Fan <Zeyu.Fan@amd.com>
Reviewed-by: Charlene Liu <Charlene.Liu@amd.com>
Acked-by: Harry Wentland <Harry.Wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/amd/display/dc/core/dc_link.c |    3 +++
 drivers/gpu/drm/amd/display/dc/dc.h           |    3 +++
 2 files changed, 6 insertions(+)

--- a/drivers/gpu/drm/amd/display/dc/core/dc_link.c
+++ b/drivers/gpu/drm/amd/display/dc/core/dc_link.c
@@ -987,6 +987,9 @@ static bool construct(
 	enc_init_data.connector = link->link_id;
 	enc_init_data.channel = get_ddc_line(link);
 	enc_init_data.hpd_source = get_hpd_line(link);
+
+	link->public.hpd_src = enc_init_data.hpd_source;
+
 	enc_init_data.transmitter =
 			translate_encoder_to_transmitter(enc_init_data.encoder);
 	link->link_enc = link->dc->res_pool->funcs->link_enc_create(
--- a/drivers/gpu/drm/amd/display/dc/dc.h
+++ b/drivers/gpu/drm/amd/display/dc/dc.h
@@ -658,6 +658,9 @@ struct dc_link {
 	struct dc_lane_settings cur_lane_setting;
 
 	uint8_t ddc_hw_inst;
+
+	uint8_t hpd_src;
+
 	uint8_t link_enc_hw_inst;
 
 	bool test_pattern_enabled;
