From: Takashi Iwai <tiwai@suse.de>
Subject: ALSA: usb-audio: workaround for iface reset issue
Patch-mainline: Never, SLE-only workaround
References: bsc#1178203

The recently introduced sample rate validation code seems causing a
problem on some devices; namely, after performing this, the bus gets
screwed and it influences even on other USB devices.
As a quick workaround, perform it only for the necessary devices;
currently MOTU devices are known to need it, so filter out others.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 sound/usb/format.c |   11 +++++++++++
 1 file changed, 11 insertions(+)

--- a/sound/usb/format.c
+++ b/sound/usb/format.c
@@ -462,6 +462,17 @@ static int validate_sample_rate_table_v2
 	unsigned int nr_rates;
 	int i, err;
 
+	/* FIXME: on SLE15-SP2 code, performing the rate verification may lead
+	 *        to unexpected USB bus behavior afterwards by some unknown
+	 *        reason.  Do this only for the known devices.
+	 */
+	switch (USB_ID_VENDOR(chip->usb_id)) {
+	case 0x07fd: /* MOTU */
+		break;
+	default:
+		return 0; /* don't perform the validation as default */
+	}
+
 	table = kcalloc(fp->nr_rates, sizeof(*table), GFP_KERNEL);
 	if (!table)
 		return -ENOMEM;
