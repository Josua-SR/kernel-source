From: Christoph Hellwig <hch@lst.de>
Date: Sat, 16 May 2020 20:28:00 +0200
Subject: [PATCH] blk-mq: remove a pointless queue enter pair in
 blk_mq_alloc_request_hctx
Git-commit: 35b371ff01410ec7c73312f1c1c320de35fcfd0f
Patch-mainline: v5.8-rc1
References: bsc#1175995,jsc#SLE-15608

No need for two queue references.

Signed-off-by: Christoph Hellwig <hch@lst.de>
Reviewed-by: Bart Van Assche <bvanassche@acm.org>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.com>
---
 block/blk-mq.c | 3 ---
 1 file changed, 3 deletions(-)

diff --git a/block/blk-mq.c b/block/blk-mq.c
index 4e62b97dceb4..b1c12de8926e 100644
--- a/block/blk-mq.c
+++ b/block/blk-mq.c
@@ -455,10 +455,7 @@ struct request *blk_mq_alloc_request_hctx(struct request_queue *q,
 	alloc_data.ctx = __blk_mq_get_ctx(q, cpu);
 
 	ret = -EWOULDBLOCK;
-	blk_queue_enter_live(q);
 	rq = blk_mq_get_request(q, NULL, &alloc_data);
-	blk_queue_exit(q);
-
 	if (!rq)
 		goto out_queue_exit;
 	return rq;
-- 
2.16.4

