From: Ben Skeggs <bskeggs@redhat.com>
Date: Wed, 1 Nov 2017 03:56:19 +1000
Subject: drm/nouveau: swap loop order in move_notify() hook
Git-commit: a48296ab9dbe8b384ba58db5e8553ba35b774bb2
Patch-mainline: v4.15-rc1
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

The conditional is the same for every mapping.

Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/nouveau/nouveau_bo.c |   10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

--- a/drivers/gpu/drm/nouveau/nouveau_bo.c
+++ b/drivers/gpu/drm/nouveau/nouveau_bo.c
@@ -1219,11 +1219,13 @@ nouveau_bo_move_ntfy(struct ttm_buffer_o
 	if (bo->destroy != nouveau_bo_del_ttm)
 		return;
 
-	list_for_each_entry(vma, &nvbo->vma_list, head) {
-		if (mem && new_reg->mem_type != TTM_PL_SYSTEM &&
-		    mem->page_shift == nvbo->page) {
+	if (mem && new_reg->mem_type != TTM_PL_SYSTEM &&
+	    mem->page_shift == nvbo->page) {
+		list_for_each_entry(vma, &nvbo->vma_list, head) {
 			nvkm_vm_map(vma, mem);
-		} else {
+		}
+	} else {
+		list_for_each_entry(vma, &nvbo->vma_list, head) {
 			WARN_ON(ttm_bo_wait(bo, false, false));
 			nvkm_vm_unmap(vma);
 		}
