From: Parav Pandit <parav@mellanox.com>
Date: Tue, 5 Jun 2018 08:40:19 +0300
Subject: net/smc: Replace ib_query_gid with rdma_get_gid_attr
Patch-mainline: v4.19-rc1
Git-commit: ddb457c6993babbcdd41fca638b870d2a2fc3941
References: bsc#1103992 FATE#326009

Push the copy of the gid_attr into the SMC code. This probably doesn't
push it far enough, as it looks like the conn->lgr should potentially hold
the reference for its lifetime.

Signed-off-by: Parav Pandit <parav@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
[Petr: This patch conflicts with 7005ada68d1774d7c1109deaba0c2cd8e46f5091
 and it was reverted in 92f4e77c85918eab5e5803d7e28ab89a7e6bd3a2 to avoid
 the conflict in a merge commit, keeping only the includes.
 Since series.conf is linear, I have squashed most of this patch and
 the reverting one.]
Signed-off-by: Petr Tesarik <ptesarik@suse.com>
---
 net/smc/smc_core.c |    1 +
 net/smc/smc_ib.c   |    1 +
 2 files changed, 2 insertions(+)

--- a/net/smc/smc_core.c
+++ b/net/smc/smc_core.c
@@ -15,6 +15,7 @@
 #include <net/tcp.h>
 #include <net/sock.h>
 #include <rdma/ib_verbs.h>
+#include <rdma/ib_cache.h>
 
 #include "smc.h"
 #include "smc_clc.h"
--- a/net/smc/smc_ib.c
+++ b/net/smc/smc_ib.c
@@ -16,6 +16,7 @@
 #include <linux/scatterlist.h>
 #include <linux/if_vlan.h>
 #include <rdma/ib_verbs.h>
+#include <rdma/ib_cache.h>
 
 #include "smc_pnet.h"
 #include "smc_ib.h"
