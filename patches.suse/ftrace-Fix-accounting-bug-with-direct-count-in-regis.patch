From: "Steven Rostedt (VMware)" <rostedt@goodmis.org>
Date: Fri, 15 Nov 2019 14:13:20 -0500
Subject: ftrace: Fix accounting bug with direct->count in
 register_ftrace_direct()
Patch-mainline: v5.5-rc1
Git-commit: 1c7f9b673dc0a15753274c4e7f5ebfd4468fc69f
References: bsc#1177028

The direct->count wasn't being updated properly, where it only was updated
when the first entry was added, but should be updated every time.

Fixes: 013bf0da04748 ("ftrace: Add ftrace_find_direct_func()")
Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
Acked-by: Gary Lin <glin@suse.com>
---
 kernel/trace/ftrace.c |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

--- a/kernel/trace/ftrace.c
+++ b/kernel/trace/ftrace.c
@@ -5069,8 +5069,7 @@ int register_ftrace_direct(unsigned long
 			ftrace_direct_func_count--;
 		}
 	} else {
-		if (!direct->count)
-			direct->count++;
+		direct->count++;
 	}
  out_unlock:
 	mutex_unlock(&direct_mutex);
