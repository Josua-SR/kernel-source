From: Sean Paul <seanpaul@chromium.org>
Date: Tue, 9 Jan 2018 13:53:51 -0500
Subject: drm/i915: Don't allow HDCP on PORT E/F
Git-commit: 2f4498a4ac2f77671587faa99e38c3342d666114
Patch-mainline: v4.17-rc1
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

Port E doesn't have HDCP support, and Port F is disabled. Don't setup
the hdcp shim on those.

Reviewed-by: Daniel Vetter <daniel@ffwll.ch>
Signed-off-by: Sean Paul <seanpaul@chromium.org>
Link: https://patchwork.freedesktop.org/patch/msgid/20180109185401.16911-1-seanpaul@chromium.org

Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/i915/intel_hdmi.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/drivers/gpu/drm/i915/intel_hdmi.c
+++ b/drivers/gpu/drm/i915/intel_hdmi.c
@@ -2340,7 +2340,8 @@ void intel_hdmi_init_connector(struct in
 
 	intel_hdmi_add_properties(intel_hdmi, connector);
 
-	if (INTEL_GEN(dev_priv) >= 9) {
+	/* PORT E doesn't have HDCP, and PORT F is disabled */
+	if (INTEL_GEN(dev_priv) >= 9 && port < PORT_E) {
 		int ret = intel_hdcp_init(intel_connector,
 					  &intel_hdmi_hdcp_shim);
 		if (ret)
