From e3747407c4d52ee3f82afdad235866e815362197 Mon Sep 17 00:00:00 2001
From: Zhenyu Wang <zhenyuw@linux.intel.com>
Date: Mon, 23 Mar 2020 17:22:36 +0800
Subject: [PATCH] KVM: x86: Expose fast short REP MOV for supported cpuid
Git-commit: e3747407c4d52ee3f82afdad235866e815362197
Patch-mainline: v5.7-rc1
References: bsc#1180334

For CPU supporting fast short REP MOV (XF86_FEATURE_FSRM) e.g Icelake,
Tigerlake, expose it in KVM supported cpuid as well.

Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>
Message-Id: <20200323092236.3703-1-zhenyuw@linux.intel.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit e3747407c4d52ee3f82afdad235866e815362197)
Acked-by: Lin Ma <lma@suse.com>
---
 arch/x86/kvm/cpuid.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/x86/kvm/cpuid.c b/arch/x86/kvm/cpuid.c
index 19a189b07670..c50719cee8b0 100644
--- a/arch/x86/kvm/cpuid.c
+++ b/arch/x86/kvm/cpuid.c
@@ -373,7 +373,7 @@ static inline void do_cpuid_7_mask(struc
 	const u32 kvm_cpuid_7_0_edx_x86_features =
 		F(AVX512_4VNNIW) | F(AVX512_4FMAPS) | F(SPEC_CTRL) |
 		F(SPEC_CTRL_SSBD) | F(ARCH_CAPABILITIES) | F(INTEL_STIBP) |
-		F(MD_CLEAR) | F(SERIALIZE) | F(TSXLDTRK) | F(AVX512_FP16);
+		F(MD_CLEAR) | F(SERIALIZE) | F(TSXLDTRK) | F(FSRM) | F(AVX512_FP16);
 
 	/* cpuid 7.1.eax */
 	const u32 kvm_cpuid_7_1_eax_x86_features =
--
2.26.2
