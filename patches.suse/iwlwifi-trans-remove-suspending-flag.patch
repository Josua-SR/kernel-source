From 3596ad2b3e87ba3dee0a7c74c1d90c9f31e5fdd8 Mon Sep 17 00:00:00 2001
From: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Date: Thu, 6 Jun 2019 11:18:46 +0300
Subject: [PATCH] iwlwifi: trans: remove suspending flag
Git-commit: 3596ad2b3e87ba3dee0a7c74c1d90c9f31e5fdd8
Patch-mainline: v5.4-rc1
References: jsc#SLE-13430

This is set but never read.

Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/net/wireless/intel/iwlwifi/iwl-trans.h |  1 -
 drivers/net/wireless/intel/iwlwifi/pcie/drv.c  | 14 --------------
 2 files changed, 15 deletions(-)

diff --git a/drivers/net/wireless/intel/iwlwifi/iwl-trans.h b/drivers/net/wireless/intel/iwlwifi/iwl-trans.h
index 20251f5e6f41..942662eaf523 100644
--- a/drivers/net/wireless/intel/iwlwifi/iwl-trans.h
+++ b/drivers/net/wireless/intel/iwlwifi/iwl-trans.h
@@ -841,7 +841,6 @@ struct iwl_trans {
 
 	enum iwl_plat_pm_mode system_pm_mode;
 	enum iwl_plat_pm_mode runtime_pm_mode;
-	bool suspending;
 
 	/* pointer to trans specific struct */
 	/*Ensure that this pointer will always be aligned to sizeof pointer */
diff --git a/drivers/net/wireless/intel/iwlwifi/pcie/drv.c b/drivers/net/wireless/intel/iwlwifi/pcie/drv.c
index d9ed53b7c768..63a04cec32af 100644
--- a/drivers/net/wireless/intel/iwlwifi/pcie/drv.c
+++ b/drivers/net/wireless/intel/iwlwifi/pcie/drv.c
@@ -1314,12 +1314,6 @@ static int iwl_pci_system_prepare(struct device *device)
 
 	IWL_DEBUG_RPM(trans, "preparing for system suspend\n");
 
-	/* This is called before entering system suspend and before
-	 * the runtime resume is called.  Set the suspending flag to
-	 * prevent the wakelock from being taken.
-	 */
-	trans->suspending = true;
-
 	/* Wake the device up from runtime suspend before going to
 	 * platform suspend.  This is needed because we don't know
 	 * whether wowlan any is set and, if it's not, mac80211 will
@@ -1336,14 +1330,6 @@ static void iwl_pci_system_complete(struct device *device)
 	struct iwl_trans *trans = pci_get_drvdata(pdev);
 
 	IWL_DEBUG_RPM(trans, "completing system suspend\n");
-
-	/* This is called as a counterpart to the prepare op.  It is
-	 * called either when suspending fails or when suspend
-	 * completed successfully.  Now there's no risk of grabbing
-	 * the wakelock anymore, so we can release the suspending
-	 * flag.
-	 */
-	trans->suspending = false;
 }
 #endif /* CONFIG_IWLWIFI_PCIE_RTPM */
 
-- 
2.16.4

