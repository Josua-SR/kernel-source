From: Thomas Bogendoerfer <tbogendoerfer@suse.de>
Date: Wed, 20 Nov 2019 17:02:36 +0100
Subject: net: ipconfig: Wait for deferred device probes
Patch-mainline: v5.5-rc1
Git-commit: e2ffe3ff6f5e18325c7a5500acd102a67fac078f
References: bsc#1154353

If network device drives are using deferred probing, it was possible
that waiting for devices to show up in ipconfig was already over,
when the device eventually showed up. By calling wait_for_device_probe()
we now make sure deferred probing is done before checking for available
devices.

Signed-off-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
Signed-off-by: David S. Miller <davem@davemloft.net>
---
 net/ipv4/ipconfig.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/net/ipv4/ipconfig.c
+++ b/net/ipv4/ipconfig.c
@@ -1412,6 +1412,9 @@ static int __init wait_for_devices(void)
 		struct net_device *dev;
 		int found = 0;
 
+		/* make sure deferred device probes are finished */
+		wait_for_device_probe();
+
 		rtnl_lock();
 		for_each_netdev(&init_net, dev) {
 			if (ic_is_init_dev(dev)) {
