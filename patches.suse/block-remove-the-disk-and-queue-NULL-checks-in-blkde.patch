From: Christoph Hellwig <hch@lst.de>
Date: Wed, 13 May 2020 14:36:01 +0200
Subject: [PATCH] block: remove the disk and queue NULL checks in
Git-commit: c81b49d4d6ca3876fad42fe99e685605294f757c
Patch-mainline: v5.8-rc1
References: bsc#1175995,jsc#SLE-15608
 blkdev_issue_flush

Both of these never can be NULL for a live block device.

Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.com>
---
 block/blk-flush.c | 8 --------
 1 file changed, 8 deletions(-)

diff --git a/block/blk-flush.c b/block/blk-flush.c
index d47a579964fb..15ae0155ec07 100644
--- a/block/blk-flush.c
+++ b/block/blk-flush.c
@@ -438,17 +438,9 @@ void blk_insert_flush(struct request *rq)
  */
 int blkdev_issue_flush(struct block_device *bdev, gfp_t gfp_mask)
 {
-	struct request_queue *q;
 	struct bio *bio;
 	int ret = 0;
 
-	if (bdev->bd_disk == NULL)
-		return -ENXIO;
-
-	q = bdev_get_queue(bdev);
-	if (!q)
-		return -ENXIO;
-
 	bio = bio_alloc(gfp_mask, 0);
 	bio_set_dev(bio, bdev);
 	bio->bi_opf = REQ_OP_WRITE | REQ_PREFLUSH;
-- 
2.16.4

