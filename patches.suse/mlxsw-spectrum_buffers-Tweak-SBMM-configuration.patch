From: Petr Machata <petrm@mellanox.com>
Date: Thu, 20 Sep 2018 09:21:33 +0300
Subject: mlxsw: spectrum_buffers: Tweak SBMM configuration
Patch-mainline: v4.20-rc1
Git-commit: 6a23f9a49722c391c5624ad1790997cd6b6b8fef
References: bsc#1112374

The SBMM register configures shared buffer allocation and settings for
MC packets according to switch priority. The recommended values are no
reserved buffer and alpha of 1/4, which corresponds to buf_max of 6.
Update mlxsw_sp_sb_mms accordingly.

Signed-off-by: Petr Machata <petrm@mellanox.com>
Reviewed-by: Jiri Pirko <jiri@mellanox.com>
Signed-off-by: Ido Schimmel <idosch@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/mellanox/mlxsw/spectrum_buffers.c |   30 ++++++++---------
 1 file changed, 15 insertions(+), 15 deletions(-)

--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum_buffers.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum_buffers.c
@@ -566,21 +566,21 @@ struct mlxsw_sp_sb_mm {
 	}
 
 static const struct mlxsw_sp_sb_mm mlxsw_sp_sb_mms[] = {
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
-	MLXSW_SP_SB_MM(20000, 0xff, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
+	MLXSW_SP_SB_MM(0, 6, 4),
 };
 
 #define MLXSW_SP_SB_MMS_LEN ARRAY_SIZE(mlxsw_sp_sb_mms)
