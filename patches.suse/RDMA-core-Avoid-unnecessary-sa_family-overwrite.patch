From: Parav Pandit <parav@mellanox.com>
Date: Wed, 5 Sep 2018 12:54:17 +0300
Subject: RDMA/core: Avoid unnecessary sa_family overwrite
Patch-mainline: v4.20-rc1
Git-commit: f89b7dfa33537bba9ee082a17a55242fc727e9f4
References: bsc#1103992 FATE#326009

addr4_resolve() and addr6_resolve() are called by checking the value of
sa_family.

Both above functions overwrite the value after typecasting, this is not
necessary.

Signed-off-by: Parav Pandit <parav@mellanox.com>
Reviewed-by: Daniel Jurgens <danielj@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/infiniband/core/addr.c |    5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

--- a/drivers/infiniband/core/addr.c
+++ b/drivers/infiniband/core/addr.c
@@ -392,7 +392,6 @@ static int addr4_resolve(struct sockaddr
 	if (ret)
 		return ret;
 
-	src_in->sin_family = AF_INET;
 	src_in->sin_addr.s_addr = fl4.saddr;
 
 	/* If there's a gateway and type of device not ARPHRD_INFINIBAND, we're
@@ -429,10 +428,8 @@ static int addr6_resolve(struct sockaddr
 		return ret;
 
 	rt = (struct rt6_info *)dst;
-	if (ipv6_addr_any(&src_in->sin6_addr)) {
-		src_in->sin6_family = AF_INET6;
+	if (ipv6_addr_any(&src_in->sin6_addr))
 		src_in->sin6_addr = fl6.saddr;
-	}
 
 	/* If there's a gateway and type of device not ARPHRD_INFINIBAND, we're
 	 * definitely in RoCE v2 (as RoCE v1 isn't routable) set the network
