From 36e79429b5c9ab6191ec3fc64bc1ad23f30dc88c Mon Sep 17 00:00:00 2001
From: Thomas Zimmermann <tzimmermann@suse.de>
Date: Thu, 16 Jan 2020 15:15:19 +0100
Subject: drm/qxl: Return error if fbdev is not 32 bpp
Patch-mainline: Never, not applicable to mainline
References: bsc#1159028

Qxl only supports 32-bit color depth. Return an error if fbdev tries to
use anything else for its framebuffers.

Signed-off-by: Thomas Zimmermann <tzimmermann@suse.de>
Acked-by: Thomas Zimmermann <tzimmermann@suse.de>
---
 drivers/gpu/drm/qxl/qxl_fb.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/gpu/drm/qxl/qxl_fb.c b/drivers/gpu/drm/qxl/qxl_fb.c
index 9a6752606079..9a139eaeeb23 100644
--- a/drivers/gpu/drm/qxl/qxl_fb.c
+++ b/drivers/gpu/drm/qxl/qxl_fb.c
@@ -227,6 +227,11 @@ static int qxlfb_create(struct qxl_fbdev *qfbdev,
 	int depth = sizes->surface_depth;
 	void *shadow;
 
+	if (bpp != 32) {
+		DRM_ERROR("qxlfb: Only 32-bit color depth is supported\n");
+		return -EINVAL;
+	}
+
 	mode_cmd.width = sizes->surface_width;
 	mode_cmd.height = sizes->surface_height;
 
-- 
2.24.1

