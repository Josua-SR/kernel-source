From: Arnaldo Carvalho de Melo <acme@kernel.org>
Date: Tue, 9 Jun 2020 18:16:53 -0300
Subject: libbpf: Define __WORDSIZE if not available
Patch-mainline: v5.8-rc1
Git-commit: 8ca8d4a841730c02e77bf3c87bf658cc44f364b9
References: bsc#1177028

Some systems, such as Android, don't have a define for __WORDSIZE, do it
in terms of __SIZEOF_LONG__, as done in perf since 2012:

   http://git.kernel.org/torvalds/c/3f34f6c0233ae055b5

For reference: https://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html

I build tested it here and Andrii did some Travis CI build tests too.

Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
Acked-by: Andrii Nakryiko <andriin@fb.com>
Link: https://lore.kernel.org/bpf/20200608161150.GA3073@kernel.org
Acked-by: Gary Lin <glin@suse.com>
---
 tools/lib/bpf/hashmap.h |    7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

--- a/tools/lib/bpf/hashmap.h
+++ b/tools/lib/bpf/hashmap.h
@@ -10,10 +10,9 @@
 
 #include <stdbool.h>
 #include <stddef.h>
-#ifdef __GLIBC__
-#include <bits/wordsize.h>
-#else
-#include <bits/reg.h>
+#include <limits.h>
+#ifndef __WORDSIZE
+#define __WORDSIZE (__SIZEOF_LONG__ * 8)
 #endif
 
 static inline size_t hash_bits(size_t h, int bits)
