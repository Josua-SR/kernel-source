From: weiping zhang <zhangweiping@didichuxing.com>
Date: Sat, 20 Jan 2018 07:34:25 +0800
Subject: [PATCH] blk-throttle: use queue_is_rq_based
Git-commit: 475a055e62a1eb92f4358ad8a9059df973c190ac
Patch-mainline: v4.16-rc1
References: bsc#1104967,FATE#325924

use queue_is_rq_based instead of open code.

Signed-off-by: weiping zhang <zhangweiping@didichuxing.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.com>
---
 block/blk-throttle.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/block/blk-throttle.c b/block/blk-throttle.c
index e136f5ef9577..c475f0fe3530 100644
--- a/block/blk-throttle.c
+++ b/block/blk-throttle.c
@@ -2489,7 +2489,7 @@ void blk_throtl_register_queue(struct request_queue *q)
 	td->throtl_slice = DFL_THROTL_SLICE_HD;
 #endif
 
-	td->track_bio_latency = !q->mq_ops && !q->request_fn;
+	td->track_bio_latency = !queue_is_rq_based(q);
 	if (!td->track_bio_latency)
 		blk_stat_enable_accounting(q);
 }
-- 
2.16.4

