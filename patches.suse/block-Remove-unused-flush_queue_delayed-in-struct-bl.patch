From: Baolin Wang <baolin.wang7@gmail.com>
Date: Sun, 17 May 2020 19:49:41 +0800
Subject: [PATCH] block: Remove unused flush_queue_delayed in struct
 blk_flush_queue
References: bsc#1175995,jsc#SLE-15608
Git-commit: 172ce41db4b2d6fa5956c4baa63475b15f5d4bd8
Patch-mainline: v5.8-rc1

The flush_queue_delayed was introdued to hold queue if flush is
running for non-queueable flush drive by commit 3ac0cc450870
("hold queue if flush is running for non-queueable flush drive"),
but the non mq parts of the flush code had been removed by
commit 7e992f847a08 ("block: remove non mq parts from the flush code"),
as well as removing the usage of the flush_queue_delayed flag.
Thus remove the unused flush_queue_delayed flag.

Signed-off-by: Baolin Wang <baolin.wang7@gmail.com>
Reviewed-by: Ming Lei <ming.lei@redhat.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 block/blk-flush.c | 1 -
 block/blk.h       | 1 -
 2 files changed, 2 deletions(-)

diff --git a/block/blk-flush.c b/block/blk-flush.c
index 843d25683691..a600b0a64caf 100644
--- a/block/blk-flush.c
+++ b/block/blk-flush.c
@@ -258,7 +258,6 @@ static void flush_end_io(struct request *flush_rq, blk_status_t error)
 		blk_flush_complete_seq(rq, fq, seq, error);
 	}
 
-	fq->flush_queue_delayed = 0;
 	spin_unlock_irqrestore(&fq->mq_flush_lock, flags);
 }
 
diff --git a/block/blk.h b/block/blk.h
index c91d0abdbcac..1d6025c3235a 100644
--- a/block/blk.h
+++ b/block/blk.h
@@ -16,7 +16,6 @@ extern struct dentry *blk_debugfs_root;
 #endif
 
 struct blk_flush_queue {
-	unsigned int		flush_queue_delayed:1;
 	unsigned int		flush_pending_idx:1;
 	unsigned int		flush_running_idx:1;
 	blk_status_t 		rq_status;
-- 
2.16.4

