From: Petr Machata <petrm@mellanox.com>
Date: Tue, 13 Feb 2018 11:27:47 +0100
Subject: mlxsw: spectrum: Drop struct span_entry.used
Patch-mainline: v4.17-rc1
Git-commit: ce470b44e256a5c25ae1f45a3086e6838fe52ecd
References: bsc#1112374

The member ref_count already determines whether a given SPAN entry is
used, and is as easy to use as a dedicated boolean.

Signed-off-by: Petr Machata <petrm@mellanox.com>
Signed-off-by: Jiri Pirko <jiri@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/mellanox/mlxsw/spectrum.c |    6 ++----
 drivers/net/ethernet/mellanox/mlxsw/spectrum.h |    1 -
 2 files changed, 2 insertions(+), 5 deletions(-)

--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum.c
@@ -534,7 +534,7 @@ mlxsw_sp_span_entry_create(struct mlxsw_
 	/* find a free entry to use */
 	index = -1;
 	for (i = 0; i < mlxsw_sp->span.entries_count; i++) {
-		if (!mlxsw_sp->span.entries[i].used) {
+		if (!mlxsw_sp->span.entries[i].ref_count) {
 			index = i;
 			span_entry = &mlxsw_sp->span.entries[i];
 			break;
@@ -549,7 +549,6 @@ mlxsw_sp_span_entry_create(struct mlxsw_
 	if (err)
 		return NULL;
 
-	span_entry->used = true;
 	span_entry->id = index;
 	span_entry->ref_count = 1;
 	span_entry->local_port = local_port;
@@ -565,7 +564,6 @@ static void mlxsw_sp_span_entry_destroy(
 
 	mlxsw_reg_mpat_pack(mpat_pl, pa_id, local_port, false);
 	mlxsw_reg_write(mlxsw_sp->core, MLXSW_REG(mpat), mpat_pl);
-	span_entry->used = false;
 }
 
 struct mlxsw_sp_span_entry *
@@ -576,7 +574,7 @@ mlxsw_sp_span_entry_find(struct mlxsw_sp
 	for (i = 0; i < mlxsw_sp->span.entries_count; i++) {
 		struct mlxsw_sp_span_entry *curr = &mlxsw_sp->span.entries[i];
 
-		if (curr->used && curr->local_port == local_port)
+		if (curr->ref_count && curr->local_port == local_port)
 			return curr;
 	}
 	return NULL;
--- a/drivers/net/ethernet/mellanox/mlxsw/spectrum.h
+++ b/drivers/net/ethernet/mellanox/mlxsw/spectrum.h
@@ -127,7 +127,6 @@ struct mlxsw_sp_span_inspected_port {
 
 struct mlxsw_sp_span_entry {
 	u8 local_port;
-	bool used;
 	struct list_head bound_ports_list;
 	int ref_count;
 	int id;
