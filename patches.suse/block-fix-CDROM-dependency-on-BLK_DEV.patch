From: Arnd Bergmann <arnd@arndb.de>
Date: Thu, 2 Nov 2017 12:19:32 +0100
Subject: [PATCH] block: fix CDROM dependency on BLK_DEV
Git-commit: c091fbe9a26ee116d99e2c0ed010afb957a10365
Patch-mainline: v4.15-rc1
References: bsc#1104967,FATE#325924

After the cdrom cleanup, I get randconfig warnings for some configurations:

warning: (BLK_DEV_IDECD && BLK_DEV_SR) selects CDROM which has unmet direct dependencies (BLK_DEV)

This adds an explicit BLK_DEV dependency for both drivers. The other
drivers that select 'CDROM' already have this and don't need a change.

Fixes: 2a750166a5be ("block: Rework drivers/cdrom/Makefile")
Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.com>
---
 drivers/ide/Kconfig  | 1 +
 drivers/scsi/Kconfig | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/ide/Kconfig b/drivers/ide/Kconfig
index 7b92c591e4c1..cf1fb3fb5d26 100644
--- a/drivers/ide/Kconfig
+++ b/drivers/ide/Kconfig
@@ -117,6 +117,7 @@ config BLK_DEV_DELKIN
 
 config BLK_DEV_IDECD
 	tristate "Include IDE/ATAPI CDROM support"
+	depends on BLK_DEV
 	select IDE_ATAPI
 	select CDROM
 	---help---
diff --git a/drivers/scsi/Kconfig b/drivers/scsi/Kconfig
index cca0b03c2ead..766955318005 100644
--- a/drivers/scsi/Kconfig
+++ b/drivers/scsi/Kconfig
@@ -130,7 +130,7 @@ config CHR_DEV_OSST
 
 config BLK_DEV_SR
 	tristate "SCSI CDROM support"
-	depends on SCSI
+	depends on SCSI && BLK_DEV
 	select CDROM
 	---help---
 	  If you want to use a CD or DVD drive attached to your computer
-- 
2.16.4

