From: Shaohua Li <shli@fb.com>
Date: Mon, 28 Aug 2017 13:49:31 -0700
Subject: [PATCH] block/nullb: delete unnecessary memory free
Git-commit: 060fd198a3e113047da456f15889579067e6b75f
Patch-mainline: v4.14-rc1
References: bsc#1104967,FATE#325924

Commit 2984c86(nullb: factor disk parameters) has a typo. The
nullb_device allocation/free is done outside of null_add_dev. The commit
accidentally frees the nullb_device in error code path.

Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: Shaohua Li <shli@fb.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.com>
---
 drivers/block/null_blk.c | 1 -
 1 file changed, 1 deletion(-)

diff --git a/drivers/block/null_blk.c b/drivers/block/null_blk.c
index 647213525549..3b5cabe374d2 100644
--- a/drivers/block/null_blk.c
+++ b/drivers/block/null_blk.c
@@ -1909,7 +1909,6 @@ static int null_add_dev(struct nullb_device *dev)
 out_free_nullb:
 	kfree(nullb);
 out:
-	null_free_dev(dev);
 	return rv;
 }
 
-- 
2.16.4

