From: Guo Xuenan <guoxuenan@huawei.com>
Date: Sun, 28 Jun 2020 09:56:25 -0400
Subject: [PATCH] blk-rq-qos: remove redundant finish_wait to rq_qos_wait.
References: bsc#1175995,jsc#SLE-15608
Git-commit: 826f2f48da8c331ac51e1381998d318012d66550
Patch-mainline: v5.9-rc1

It is no need do finish_wait twice after acquiring inflight.

Signed-off-by: Guo Xuenan <guoxuenan@huawei.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 block/blk-rq-qos.c | 2 --
 1 file changed, 2 deletions(-)

diff --git a/block/blk-rq-qos.c b/block/blk-rq-qos.c
index 656460636ad3..18f3eab9f768 100644
--- a/block/blk-rq-qos.c
+++ b/block/blk-rq-qos.c
@@ -273,8 +273,6 @@ void rq_qos_wait(struct rq_wait *rqw, void *private_data,
 		if (data.got_token)
 			break;
 		if (!has_sleeper && acquire_inflight_cb(rqw, private_data)) {
-			finish_wait(&rqw->wait, &data.wq);
-
 			/*
 			 * We raced with wbt_wake_function() getting a token,
 			 * which means we now have two. Put our local token
-- 
2.16.4

