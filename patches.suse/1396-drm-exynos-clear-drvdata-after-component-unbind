From: Marek Szyprowski <m.szyprowski@samsung.com>
Date: Mon, 9 Oct 2017 10:44:01 +0200
Subject: drm/exynos: Clear drvdata after component unbind
Git-commit: 238604ca0b708319e089e22545bcda39afb5faa8
Patch-mainline: v4.14-rc6
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

When components are unbound, DRM driver is unregistered and freed,
so clear drvdata to avoid potential use-after-free issue in
suspend/resume paths.

Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
Signed-off-by: Inki Dae <inki.dae@samsung.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/exynos/exynos_drm_drv.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/gpu/drm/exynos/exynos_drm_drv.c
+++ b/drivers/gpu/drm/exynos/exynos_drm_drv.c
@@ -430,6 +430,7 @@ static void exynos_drm_unbind(struct dev
 
 	kfree(drm->dev_private);
 	drm->dev_private = NULL;
+	dev_set_drvdata(dev, NULL);
 
 	drm_dev_unref(drm);
 }
