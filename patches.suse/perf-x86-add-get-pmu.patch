From: Stephane Eranian <eranian@google.com>
Date: Mon, 8 Apr 2019 10:32:52 -0700
Subject: perf/x86/intel: Force resched when TFA sysctl is modified
Git-commit: f447e4eb3ad1e60d173ca997fcb2ef2a66f12574
Patch-mainline: v5.2-rc1
References: jsc#SLE-5373 (git-fixes dependent patch)
X-Info: adding just for x86_get_pmu, full backport of patch in beta3 

Cherry pick x86_get_pmu from f447e4eb3ad1e60d173ca997fcb2ef2a66f12574

Signed-off-by: Tony Jones <tonyj@suse.de>
---
 arch/x86/events/core.c       |  4 ++++
 arch/x86/events/perf_event.h |  1 +
 3 files changed, 53 insertions(+), 2 deletions(-)

diff --git a/arch/x86/events/core.c b/arch/x86/events/core.c
index 87b50f4be201..fdd106267fd2 100644
--- a/arch/x86/events/core.c
+++ b/arch/x86/events/core.c
@@ -661,6 +661,10 @@ static inline int is_x86_event(struct perf_event *event)
 	return event->pmu == &pmu;
 }
 
+struct pmu *x86_get_pmu(void)
+{
+	return &pmu;
+}
 /*
  * Event scheduler state:
  *
diff --git a/arch/x86/events/perf_event.h b/arch/x86/events/perf_event.h
index e544d83ea4b4..9e474a5f3b86 100644
--- a/arch/x86/events/perf_event.h
+++ b/arch/x86/events/perf_event.h
@@ -713,6 +713,7 @@ static struct perf_pmu_events_ht_attr event_attr_##v = {		\
 	.event_str_ht	= ht,						\
 }
 
+struct pmu *x86_get_pmu(void);
 extern struct x86_pmu x86_pmu __read_mostly;
 
 static inline bool x86_pmu_has_lbr_callstack(void)

