From: Baolin Wang <baolin.wang@linux.alibaba.com>
Date: Sat, 4 Jul 2020 15:28:21 +0800
Subject: [PATCH] blk-mq: remove redundant validation in __blk_mq_end_request()
References: bsc#1175995,jsc#SLE-15608
Git-commit: 87890092ee6504a49841d854ff81a71a85c19a5d
Patch-mainline: v5.9-rc1

We've already validated the 'q->elevator' before calling
->ops.completed_request() in blk_mq_sched_completed_request(), thus no
need to validate rq->internal_tag again. Rmove it.

Signed-off-by: Baolin Wang <baolin.wang@linux.alibaba.com>
Reviewed-by: Ming Lei <ming.lei@redhat.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 block/blk-mq.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/block/blk-mq.c b/block/blk-mq.c
index 2abd296ca72c..6da2ad229ea1 100644
--- a/block/blk-mq.c
+++ b/block/blk-mq.c
@@ -522,8 +522,7 @@ inline void __blk_mq_end_request(struct request *rq, blk_status_t error)
 		blk_stat_add(rq, now);
 	}
 
-	if (rq->internal_tag != BLK_MQ_NO_TAG)
-		blk_mq_sched_completed_request(rq, now);
+	blk_mq_sched_completed_request(rq, now);
 
 	blk_account_io_done(rq, now);
 
-- 
2.16.4

