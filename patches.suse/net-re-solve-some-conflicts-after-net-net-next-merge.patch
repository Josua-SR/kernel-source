From b646acd5eb48ec49ef90404336d7e8ee502ecd05 Mon Sep 17 00:00:00 2001
From: Jakub Kicinski <kuba@kernel.org>
Date: Tue, 16 Feb 2021 22:58:44 -0800
Subject: [PATCH] net: re-solve some conflicts after net -> net-next merge

References: jsc#SLE-17268 bsc#1176855 ltc#187293
Patch-mainline: v5.12-rc1
Git-commit: b646acd5eb48ec49ef90404336d7e8ee502ecd05 (ibmvnic only)

Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Michal Suchanek <msuchanek@suse.de>
---
 drivers/net/ethernet/ibm/ibmvnic.c            |  5 ++--
 drivers/net/ethernet/ibm/ibmvnic.h            | 10 +++++---
 .../net/ethernet/mellanox/mlx5/core/en_main.c |  5 ----
 drivers/net/ethernet/realtek/r8169_main.c     | 25 -------------------
 .../selftests/net/forwarding/tc_flower.sh     |  3 ++-
 5 files changed, 11 insertions(+), 37 deletions(-)

--- a/drivers/net/ethernet/ibm/ibmvnic.c
+++ b/drivers/net/ethernet/ibm/ibmvnic.c
@@ -2400,8 +2400,7 @@ static int ibmvnic_reset(struct ibmvnic_
 
 	spin_lock_irqsave(&adapter->rwi_lock, flags);
 
-	/*
-	 * If failover is pending don't schedule any other reset.
+	/* If failover is pending don't schedule any other reset.
 	 * Instead let the failover complete. If there is already a
 	 * a failover reset scheduled, we will detect and drop the
 	 * duplicate reset when walking the ->rwi_list below.
--- a/drivers/net/ethernet/ibm/ibmvnic.h
+++ b/drivers/net/ethernet/ibm/ibmvnic.h
@@ -1080,10 +1080,16 @@ struct ibmvnic_adapter {
 
 	struct tasklet_struct tasklet;
 	enum vnic_state state;
+	/* Used for serialization of state field. When taking both state
+	 * and rwi locks, take state lock first.
+	 */
+	spinlock_t state_lock;
+	struct list_head rwi_list;
 	enum ibmvnic_reset_reason reset_reason;
-	/* when taking both state and rwi locks, take state lock first */
+	/* Used for serialization of state field. When taking both state
+	 * and rwi locks, take state lock first.
+	 */
 	spinlock_t rwi_lock;
-	struct list_head rwi_list;
 	struct work_struct ibmvnic_reset;
 	struct delayed_work ibmvnic_delayed_reset;
 	unsigned long resetting;
@@ -1097,9 +1103,4 @@ struct ibmvnic_adapter {
 
 	struct ibmvnic_tunables desired;
 	struct ibmvnic_tunables fallback;
-
-	/* Used for serialization of state field. When taking both state
-	 * and rwi locks, take state lock first.
-	 */
-	spinlock_t state_lock;
 };
