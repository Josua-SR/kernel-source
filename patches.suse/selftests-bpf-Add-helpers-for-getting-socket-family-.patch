From: Jakub Sitnicki <jakub@cloudflare.com>
Date: Thu, 12 Dec 2019 11:22:53 +0100
Subject: selftests/bpf: Add helpers for getting socket family & type name
Patch-mainline: v5.6-rc1
Git-commit: a9ce4cf4e47c55ab40641b92551bc9e1de4bfa61
References: bsc#1177028

Having string arrays to map socket family & type to a name prevents us from
unrolling the test runner loop in the subsequent patch. Introduce helpers
that do the same thing.

Signed-off-by: Jakub Sitnicki <jakub@cloudflare.com>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: https://lore.kernel.org/bpf/20191212102259.418536-5-jakub@cloudflare.com
Acked-by: Gary Lin <glin@suse.com>
---
 tools/testing/selftests/bpf/test_select_reuseport.c |   28 +++++++++++++++++---
 1 file changed, 25 insertions(+), 3 deletions(-)

--- a/tools/testing/selftests/bpf/test_select_reuseport.c
+++ b/tools/testing/selftests/bpf/test_select_reuseport.c
@@ -674,12 +674,34 @@ static void cleanup(void)
 	bpf_object__close(obj);
 }
 
+static const char *family_str(sa_family_t family)
+{
+	switch (family) {
+	case AF_INET:
+		return "IPv4";
+	case AF_INET6:
+		return "IPv6";
+	default:
+		return "unknown";
+	}
+}
+
+static const char *sotype_str(int sotype)
+{
+	switch (sotype) {
+	case SOCK_STREAM:
+		return "TCP";
+	case SOCK_DGRAM:
+		return "UDP";
+	default:
+		return "unknown";
+	}
+}
+
 static void test_all(void)
 {
 	/* Extra SOCK_STREAM to test bind_inany==true */
 	const int types[] = { SOCK_STREAM, SOCK_DGRAM, SOCK_STREAM };
-	const char * const type_strings[] = { "TCP", "UDP", "TCP" };
-	const char * const family_strings[] = { "IPv6", "IPv4" };
 	const sa_family_t families[] = { AF_INET6, AF_INET };
 	const bool bind_inany[] = { false, false, true };
 	int t, f, err;
@@ -692,7 +714,7 @@ static void test_all(void)
 			int type = types[t];
 
 			printf("######## %s/%s %s ########\n",
-			       family_strings[f], type_strings[t],
+			       family_str(family), sotype_str(type),
 				inany ? " INANY  " : "LOOPBACK");
 
 			setup_per_test(type, family, inany);
