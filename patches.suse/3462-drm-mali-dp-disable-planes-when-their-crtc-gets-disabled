From: Liviu Dudau <Liviu.Dudau@arm.com>
Date: Thu, 31 Aug 2017 17:39:24 +0100
Subject: drm: mali-dp: Disable planes when their CRTC gets disabled.
Git-commit: 54243016ae35a0912a680f884835237fd6176820
Patch-mainline: v4.15-rc2
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

Make sure only the planes on the active CRTCs get committed and
that all planes on the disabled CRTCs get turned off.

Reviewed-by: Brian Starkey <brian.starkey@arm.com>
Reviewed-by: Gustavo Padovan <gustavo.padovan@collabora.com>
Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/arm/malidp_crtc.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/drivers/gpu/drm/arm/malidp_crtc.c
+++ b/drivers/gpu/drm/arm/malidp_crtc.c
@@ -77,6 +77,9 @@ static void malidp_crtc_atomic_disable(s
 	struct malidp_hw_device *hwdev = malidp->dev;
 	int err;
 
+	/* always disable planes on the CRTC that is being turned off */
+	drm_atomic_helper_disable_planes_on_crtc(old_state, false);
+
 	drm_crtc_vblank_off(crtc);
 	hwdev->hw->enter_config_mode(hwdev);
 
