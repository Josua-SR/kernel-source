From 006f4a5176c42360a691953b897c8e2c7941826d Mon Sep 17 00:00:00 2001
From: Hannes Reinecke <hare@suse.de>
Date: Thu, 23 Jul 2020 08:24:28 +0200
Subject: [PATCH 1/4] scsi: block: return status code in blk_mq_end_request()
Git-commit: e21ee5a6b9c9d30fd07ce5bd3e4a5668a03af6d9
Patch-mainline: v5.11-rc1
References: bsc#1171000, bsc#1165933

blk_mq_end_request() will use the block status returned from
queue_rq() as argument, except in one instance in blk_mq_dispatch_rq_list(),
where the generic BLK_STS_IOERR is used.

Link: https://lore.kernel.org/r/20200930080256.90964-2-hare@suse.de
Reviewed-by: Ewan D. Milne <emilne@redhat.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Acked-by: Martin Wilck <mwilck@suse.com>
---
 block/blk-mq.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/block/blk-mq.c b/block/blk-mq.c
index 565644b36b87..ae41216b2798 100644
--- a/block/blk-mq.c
+++ b/block/blk-mq.c
@@ -1288,7 +1288,7 @@ bool blk_mq_dispatch_rq_list(struct request_queue *q, struct list_head *list,
 
 		if (unlikely(ret != BLK_STS_OK)) {
 			errors++;
-			blk_mq_end_request(rq, BLK_STS_IOERR);
+			blk_mq_end_request(rq, ret);
 			continue;
 		}
 
-- 
2.16.4

