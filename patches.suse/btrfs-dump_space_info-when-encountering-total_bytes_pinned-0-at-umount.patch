From: Jeff Mahoney <jeffm@suse.com>
Subject: btrfs: dump_space_info when encountering total_bytes_pinned != 0 at umount
Patch-mainline: Submitted, as review feedback: https://www.spinics.net/lists/linux-btrfs/msg66484.html
References: bsc#1040182

This patch dumps the spaceinfo when we hit total_bytes_pinned != 0 so we
can track down likely causes.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>
---
 fs/btrfs/space-info.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/fs/btrfs/space-info.c
+++ b/fs/btrfs/space-info.c
@@ -380,6 +380,8 @@ void btrfs_dump_space_info(struct btrfs_
 		info->total_bytes, info->bytes_used, info->bytes_pinned,
 		info->bytes_reserved, info->bytes_may_use,
 		info->bytes_readonly);
+	btrfs_info(fs_info, "total_bytes_pinned=%lld",
+		   percpu_counter_sum(&info->total_bytes_pinned));
 	spin_unlock(&info->lock);
 
 	DUMP_BLOCK_RSV(fs_info, global_block_rsv);
