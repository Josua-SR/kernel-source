From: Al Viro <viro@zeniv.linux.org.uk>
Date: Thu, 25 May 2017 16:27:27 -0400
Subject: drm_compat_ioctl(): tidy up a bit
Git-commit: 88e3cb07857584a20f66dce5e4a21b43ebbc967e
Patch-mainline: v4.13-rc1
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/drm_ioc32.c |   22 +++++++++-------------
 1 file changed, 9 insertions(+), 13 deletions(-)

--- a/drivers/gpu/drm/drm_ioc32.c
+++ b/drivers/gpu/drm/drm_ioc32.c
@@ -951,6 +951,7 @@ static struct {
 long drm_compat_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)
 {
 	unsigned int nr = DRM_IOCTL_NR(cmd);
+	struct drm_file *file_priv = filp->private_data;
 	drm_ioctl_compat_t *fn;
 	int ret;
 
@@ -965,19 +966,14 @@ long drm_compat_ioctl(struct file *filp,
 	if (!fn)
 		return drm_ioctl(filp, cmd, arg);
 
-	if (drm_compat_ioctls[nr].name) {
-		struct drm_file *file_priv = filp->private_data;
-		DRM_DEBUG("pid=%d, dev=0x%lx, auth=%d, %s\n",
-			  task_pid_nr(current),
-			  (long)old_encode_dev(file_priv->minor->kdev->devt),
-			  file_priv->authenticated,
-			  drm_compat_ioctls[nr].name);
-		ret = (*fn) (filp, cmd, arg);
-		if (ret)
-			DRM_DEBUG("ret = %d\n", ret);
-	} else {
-		ret = (*fn) (filp, cmd, arg);
-	}
+	DRM_DEBUG("pid=%d, dev=0x%lx, auth=%d, %s\n",
+		  task_pid_nr(current),
+		  (long)old_encode_dev(file_priv->minor->kdev->devt),
+		  file_priv->authenticated,
+		  drm_compat_ioctls[nr].name);
+	ret = (*fn)(filp, cmd, arg);
+	if (ret)
+		DRM_DEBUG("ret = %d\n", ret);
 	return ret;
 }
 EXPORT_SYMBOL(drm_compat_ioctl);
