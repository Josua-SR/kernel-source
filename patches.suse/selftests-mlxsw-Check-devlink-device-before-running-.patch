From: Danielle Ratson <danieller@mellanox.com>
Date: Mon, 18 Nov 2019 09:49:59 +0200
Subject: selftests: mlxsw: Check devlink device before running test
Patch-mainline: v5.5-rc1
Git-commit: b22b0b0b10aa16bfe020f0ce506ab78a4d8a5fd4
References: bsc#1176774

The scale test for Spectrum-2 should only be invoked for Spectrum-2.
Skip the test otherwise.

Signed-off-by: Danielle Ratson <danieller@mellanox.com>
Signed-off-by: Ido Schimmel <idosch@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 tools/testing/selftests/drivers/net/mlxsw/spectrum-2/resource_scale.sh |    5 +++++
 1 file changed, 5 insertions(+)

--- a/tools/testing/selftests/drivers/net/mlxsw/spectrum-2/resource_scale.sh
+++ b/tools/testing/selftests/drivers/net/mlxsw/spectrum-2/resource_scale.sh
@@ -8,6 +8,11 @@ source $lib_dir/lib.sh
 source $lib_dir/tc_common.sh
 source $lib_dir/devlink_lib.sh
 
+if [ "$DEVLINK_VIDDID" != "15b3:cf6c" ]; then
+	echo "SKIP: test is tailored for Mellanox Spectrum-2"
+	exit 1
+fi
+
 current_test=""
 
 cleanup()
