From: Stefan Raspl <raspl@linux.ibm.com>
Subject: net/smc: remove local variable page in smc_rx_splice()
Patch-mainline: v4.19-rc1
Git-commit: 48bf5231771c7e3961c8326353b6027b1bed6eb5
References: FATE#325698, LTC#167867, bsc#1113481

Description:  smc: Latest upstream fixes and extensions up to 8/17/2018

Upstream-Description:

              net/smc: remove local variable page in smc_rx_splice()

              The page map address is already stored in the RMB descriptor.
              There is no need to derive it from the cpu_addr value.

              Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>
              Signed-off-by: David S. Miller <davem@davemloft.net>

Signed-off-by: Stefan Raspl <raspl@linux.ibm.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 net/smc/smc_rx.c |    4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

--- a/net/smc/smc_rx.c
+++ b/net/smc/smc_rx.c
@@ -154,10 +154,8 @@ static int smc_rx_splice(struct pipe_ino
 	struct splice_pipe_desc spd;
 	struct partial_page partial;
 	struct smc_spd_priv *priv;
-	struct page *page;
 	int bytes;
 
-	page = virt_to_page(smc->conn.rmb_desc->cpu_addr);
 	priv = kzalloc(sizeof(*priv), GFP_KERNEL);
 	if (!priv)
 		return -ENOMEM;
@@ -169,7 +167,7 @@ static int smc_rx_splice(struct pipe_ino
 
 	spd.nr_pages_max = 1;
 	spd.nr_pages = 1;
-	spd.pages = &page;
+	spd.pages = &smc->conn.rmb_desc->pages;
 	spd.partial = &partial;
 	spd.ops = &smc_pipe_ops;
 	spd.spd_release = smc_rx_spd_release;
