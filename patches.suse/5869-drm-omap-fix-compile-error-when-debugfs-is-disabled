From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Wed, 14 Mar 2018 10:23:52 +0200
Subject: drm/omap: fix compile error when debugfs is disabled
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Git-commit: 83df2d4ed559442cdb5a1364c69aef3e682dceb0
Patch-mainline: v4.17-rc1
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

When compiling with CONFIG_OMAP2_DSS_DEBUGFS disabled, build fails due
to:

drivers/gpu/drm/omapdrm/dss/dss.c:1474:10: error: ‘dss_debug_dump_clocks’ undeclared (first use in this function); did you mean ‘dispc_dump_clocks’?
          dss_debug_dump_clocks, dss);
          ^~~~~~~~~~~~~~~~~~~~~
          dispc_dump_clocks

Fix this by moving the required functions outside #if
defined(CONFIG_OMAP2_DSS_DEBUGFS).

In the long term, we perhaps want to try to get all the debugfs support
left out if debugfs is not enabled.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/omapdrm/dss/dss.c |   26 ++++++++++++--------------
 1 file changed, 12 insertions(+), 14 deletions(-)

--- a/drivers/gpu/drm/omapdrm/dss/dss.c
+++ b/drivers/gpu/drm/omapdrm/dss/dss.c
@@ -343,7 +343,6 @@ const char *dss_get_clk_source_name(enum
 	return dss_generic_clk_source_names[clk_src];
 }
 
-#if defined(CONFIG_OMAP2_DSS_DEBUGFS)
 static void dss_dump_clocks(struct dss_device *dss, struct seq_file *s)
 {
 	const char *fclk_name;
@@ -363,7 +362,6 @@ static void dss_dump_clocks(struct dss_d
 
 	dss_runtime_put(dss);
 }
-#endif
 
 static int dss_dump_regs(struct seq_file *s, void *p)
 {
@@ -390,6 +388,18 @@ static int dss_dump_regs(struct seq_file
 	return 0;
 }
 
+static int dss_debug_dump_clocks(struct seq_file *s, void *p)
+{
+	struct dss_device *dss = s->private;
+
+	dss_dump_clocks(dss, s);
+	dispc_dump_clocks(dss->dispc, s);
+#ifdef CONFIG_OMAP2_DSS_DSI
+	dsi_dump_clocks(s);
+#endif
+	return 0;
+}
+
 static int dss_get_channel_index(enum omap_channel channel)
 {
 	switch (channel) {
@@ -889,18 +899,6 @@ struct dss_device *dss_get_device(struct
 
 /* DEBUGFS */
 #if defined(CONFIG_OMAP2_DSS_DEBUGFS)
-static int dss_debug_dump_clocks(struct seq_file *s, void *p)
-{
-	struct dss_device *dss = s->private;
-
-	dss_dump_clocks(dss, s);
-	dispc_dump_clocks(dss->dispc, s);
-#ifdef CONFIG_OMAP2_DSS_DSI
-	dsi_dump_clocks(s);
-#endif
-	return 0;
-}
-
 static int dss_initialize_debugfs(struct dss_device *dss)
 {
 	struct dentry *dir;
