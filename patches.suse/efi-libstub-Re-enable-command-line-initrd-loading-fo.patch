From: Ard Biesheuvel <ardb@kernel.org>
Date: Sat, 25 Apr 2020 12:22:04 +0200
Subject: efi/libstub: Re-enable command line initrd loading for x86
Patch-mainline: v5.8-rc1
Git-commit: 4da0b2b7e67524cc206067865666899bc02e1cb0
References: jsc#SLE-16407

Commit:

  cf6b83664895a5 ("efi/libstub: Make initrd file loader configurable")

inadvertently disabled support on x86 for loading an initrd passed via
the initrd= option on the kernel command line.

Add X86 to the newly introduced Kconfig option's title and depends
declarations, so it gets enabled by default, as before.

Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Signed-off-by: Ingo Molnar <mingo@kernel.org>
Cc: linux-efi@vger.kernel.org
Acked-by: Lee, Chun-Yi <jlee@suse.com>
---
 drivers/firmware/efi/Kconfig |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/firmware/efi/Kconfig
+++ b/drivers/firmware/efi/Kconfig
@@ -125,8 +125,8 @@ config EFI_ARMSTUB_DTB_LOADER
 	  this option is necessary.
 
 config EFI_GENERIC_STUB_INITRD_CMDLINE_LOADER
-	bool "Enable the command line initrd loader"
-	depends on EFI_GENERIC_STUB
+	bool "Enable the command line initrd loader" if !X86
+	depends on EFI_STUB && (EFI_GENERIC_STUB || X86)
 	default y
 	help
 	  Select this config option to add support for the initrd= command
