From: Jiri Pirko <jiri@mellanox.com>
Date: Thu, 10 Oct 2019 15:18:48 +0200
Subject: devlink: don't do reporter recovery if the state is healthy
Patch-mainline: v5.5-rc1
Git-commit: 402818205c9ecdfd922fdfa58fb113f60fdda523
References: bsc#1154353

If reporter state is healthy, don't call into a driver for recover and
don't increase recovery count.

Signed-off-by: Jiri Pirko <jiri@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 net/core/devlink.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/net/core/devlink.c
+++ b/net/core/devlink.c
@@ -4852,6 +4852,9 @@ devlink_health_reporter_recover(struct d
 {
 	int err;
 
+	if (reporter->health_state == DEVLINK_HEALTH_REPORTER_STATE_HEALTHY)
+		return 0;
+
 	if (!reporter->ops->recover)
 		return -EOPNOTSUPP;
 
