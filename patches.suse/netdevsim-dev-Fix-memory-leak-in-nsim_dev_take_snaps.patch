From: "Gustavo A. R. Silva" <gustavo@embeddedor.com>
Date: Mon, 30 Mar 2020 18:27:02 -0500
Subject: netdevsim: dev: Fix memory leak in nsim_dev_take_snapshot_write
Patch-mainline: v5.7-rc1
Git-commit: 3902baf9abfa320b21e38fe206d66d5e6688e721
References: jsc#SLE-15171

In case memory resources for dummy_data were allocated, release them
before return.

Addresses-Coverity-ID: 1491997 ("Resource leak")
Fixes: 7ef19d3b1d5e ("devlink: report error once U32_MAX snapshot ids have been used")
Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
Reviewed-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/netdevsim/dev.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/net/netdevsim/dev.c
+++ b/drivers/net/netdevsim/dev.c
@@ -59,6 +59,7 @@ static ssize_t nsim_dev_take_snapshot_wr
 	err = devlink_region_snapshot_id_get(devlink, &id);
 	if (err) {
 		pr_err("Failed to get snapshot id\n");
+		kfree(dummy_data);
 		return err;
 	}
 	err = devlink_region_snapshot_create(nsim_dev->dummy_region,
