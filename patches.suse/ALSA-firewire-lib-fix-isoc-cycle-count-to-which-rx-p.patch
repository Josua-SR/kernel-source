From f155e79ab516c9ed2adb2f337fb4ff58b7474428 Mon Sep 17 00:00:00 2001
From: Takashi Sakamoto <o-takashi@sakamocchi.jp>
Date: Thu, 29 Aug 2019 23:38:08 +0900
Subject: [PATCH] ALSA: firewire-lib: fix isoc cycle count to which rx packet is scheduled
Git-commit: f155e79ab516c9ed2adb2f337fb4ff58b7474428
Patch-mainline: v5.4-rc1
References: jsc#SLE-16518

When introducing the list of packet descriptor, for rx packet, the
calculation of scheduled isoc cycle is omitted. This commit fixes the
bug.

Fixes: f4f6ae7b7c1f ("ALSA: firewire-lib: use packet descriptor for IT context")
Signed-off-by: Takashi Sakamoto <o-takashi@sakamocchi.jp>
Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 sound/firewire/amdtp-stream.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/sound/firewire/amdtp-stream.c b/sound/firewire/amdtp-stream.c
index 1a92855c7647..88270257e896 100644
--- a/sound/firewire/amdtp-stream.c
+++ b/sound/firewire/amdtp-stream.c
@@ -732,7 +732,7 @@ static void generate_ideal_pkt_descs(struct amdtp_stream *s,
 		struct pkt_desc *desc = descs + i;
 		unsigned int index = (s->packet_index + i) % QUEUE_LENGTH;
 
-		desc->cycle = compute_cycle_count(*ctx_header);
+		desc->cycle = compute_it_cycle(*ctx_header);
 		desc->syt = calculate_syt(s, desc->cycle);
 		desc->data_blocks = calculate_data_blocks(s, desc->syt);
 
-- 
2.16.4

