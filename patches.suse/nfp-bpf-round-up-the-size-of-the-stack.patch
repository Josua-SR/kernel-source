From: Jakub Kicinski <jakub.kicinski@netronome.com>
Date: Wed, 10 Jan 2018 12:25:56 +0000
Subject: nfp: bpf: round up the size of the stack
Patch-mainline: v4.16-rc1
Git-commit: c4f7730be580f8c39decc058246a83ddf7d7b3cb
References: bsc#1109837

Kernel enforces the alignment of the bottom of the stack, NFP
deals with positive offsets better so we should align the top
of the stack.  Round the stack size to NFP word size (4B).

Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>
Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/netronome/nfp/bpf/offload.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/net/ethernet/netronome/nfp/bpf/offload.c
+++ b/drivers/net/ethernet/netronome/nfp/bpf/offload.c
@@ -147,7 +147,7 @@ int nfp_bpf_translate(struct nfp_app *ap
 		return -EOPNOTSUPP;
 	}
 
-	nfp_prog->stack_depth = prog->aux->stack_depth;
+	nfp_prog->stack_depth = round_up(prog->aux->stack_depth, 4);
 	nfp_prog->start_off = nn_readw(nn, NFP_NET_CFG_BPF_START);
 	nfp_prog->tgt_done = nn_readw(nn, NFP_NET_CFG_BPF_DONE);
 
