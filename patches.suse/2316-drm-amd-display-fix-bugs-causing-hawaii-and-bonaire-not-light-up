From: Zeyu Fan <Zeyu.Fan@amd.com>
Date: Tue, 6 Dec 2016 12:59:52 -0500
Subject: drm/amd/display: Fix bugs causing Hawaii and Bonaire not light up.
Git-commit: 8e545104aa05b5e0720fd2042e2f9729f9c13744
Patch-mainline: v4.15-rc1
References: FATE#326289 FATE#326079 FATE#326049 FATE#322398 FATE#326166

Signed-off-by: Zeyu Fan <Zeyu.Fan@amd.com>
Acked-by: Jordan Lazare <Jordan.Lazare@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/gpu/drm/amd/display/dc/bios/dce110/command_table_helper_dce110.c |    2 +-
 drivers/gpu/drm/amd/display/dc/bios/dce112/command_table_helper_dce112.c |    2 +-
 drivers/gpu/drm/amd/display/dc/dce/dce_link_encoder.c                    |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

--- a/drivers/gpu/drm/amd/display/dc/bios/dce110/command_table_helper_dce110.c
+++ b/drivers/gpu/drm/amd/display/dc/bios/dce110/command_table_helper_dce110.c
@@ -186,7 +186,7 @@ static uint8_t dig_encoder_sel_to_atom(e
 		break;
 	}
 
-	return atom_dig_encoder_sel;
+	return 0;
 }
 
 static bool clock_source_id_to_atom(
--- a/drivers/gpu/drm/amd/display/dc/bios/dce112/command_table_helper_dce112.c
+++ b/drivers/gpu/drm/amd/display/dc/bios/dce112/command_table_helper_dce112.c
@@ -183,7 +183,7 @@ static uint8_t dig_encoder_sel_to_atom(e
 		break;
 	}
 
-	return atom_dig_encoder_sel;
+	return 0;
 }
 
 static bool clock_source_id_to_atom(
--- a/drivers/gpu/drm/amd/display/dc/dce/dce_link_encoder.c
+++ b/drivers/gpu/drm/amd/display/dc/dce/dce_link_encoder.c
@@ -1281,7 +1281,7 @@ void dce110_link_encoder_enable_dp_outpu
 	configure_encoder(enc110, link_settings);
 
 	cntl.action = TRANSMITTER_CONTROL_ENABLE;
-	cntl.engine_id = ENGINE_ID_UNKNOWN;
+	cntl.engine_id = enc->preferred_engine;
 	cntl.transmitter = enc110->base.transmitter;
 	cntl.pll_id = clock_source;
 	cntl.signal = SIGNAL_TYPE_DISPLAY_PORT;
