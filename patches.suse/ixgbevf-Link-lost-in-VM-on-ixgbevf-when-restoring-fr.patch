From: Radoslaw Tyl <radoslawx.tyl@intel.com>
Date: Thu, 4 Jul 2019 15:48:42 +0200
Subject: ixgbevf: Link lost in VM on ixgbevf when restoring from freeze or
 suspend
Patch-mainline: v5.4-rc1
Git-commit: d7cb9da1864d0986d5fca550e20c608d8616ff52
References: jsc#SLE-7979 jsc#SLE-7981

This patch fixed issue in VM which shows no link when hypervisor is
restored from low-power state. The driver is responsible for re-enabling
any features of the device that had been disabled during suspend calls,
such as IRQs and bus mastering.

Signed-off-by: Radoslaw Tyl <radoslawx.tyl@intel.com>
Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/intel/ixgbevf/ixgbevf_main.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/net/ethernet/intel/ixgbevf/ixgbevf_main.c
+++ b/drivers/net/ethernet/intel/ixgbevf/ixgbevf_main.c
@@ -2518,6 +2518,7 @@ void ixgbevf_reinit_locked(struct ixgbev
 		msleep(1);
 
 	ixgbevf_down(adapter);
+	pci_set_master(adapter->pdev);
 	ixgbevf_up(adapter);
 
 	clear_bit(__IXGBEVF_RESETTING, &adapter->state);
