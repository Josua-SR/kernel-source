From: Arjun Vynipadath <arjun@chelsio.com>
Date: Fri, 1 Mar 2019 16:07:01 +0530
Subject: cxgb4vf: Call netif_carrier_off properly in pci_probe
Patch-mainline: v5.1-rc1
Git-commit: 57d37aea0e2e0a8330ebf4f41150a641a8ccd869
References: bsc#1136347 jsc#SLE-4683

netif_carrier_off() should be called only after register_netdev().

Signed-off-by: Arjun Vynipadath <arjun@chelsio.com>
Signed-off-by: Vishal Kulkarni <vishal@chelsio.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/chelsio/cxgb4vf/cxgb4vf_main.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/net/ethernet/chelsio/cxgb4vf/cxgb4vf_main.c
+++ b/drivers/net/ethernet/chelsio/cxgb4vf/cxgb4vf_main.c
@@ -3136,7 +3136,6 @@ static int cxgb4vf_pci_probe(struct pci_
 		 * it.
 		 */
 		pi->xact_addr_filt = -1;
-		netif_carrier_off(netdev);
 		netdev->irq = pdev->irq;
 
 		netdev->hw_features = NETIF_F_SG | TSO_FLAGS | NETIF_F_GRO |
@@ -3259,6 +3258,7 @@ static int cxgb4vf_pci_probe(struct pci_
 			continue;
 		}
 
+		netif_carrier_off(netdev);
 		set_bit(pidx, &adapter->registered_device_map);
 	}
 	if (adapter->registered_device_map == 0) {
