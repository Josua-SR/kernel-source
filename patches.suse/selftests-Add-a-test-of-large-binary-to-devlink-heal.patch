From: Aya Levin <ayal@mellanox.com>
Date: Tue, 12 Nov 2019 14:07:52 +0200
Subject: selftests: Add a test of large binary to devlink health test
Patch-mainline: v5.5-rc1
Git-commit: ff18176ad806ea1a7f5f9b404182f97dbb6f9691
References: bsc#1176447

Add a test of 2 PAGEs size (exceeds devlink previous length limitation)
of binary data on a 'devlink health dump show' command. Set binary length
to 8192, issue a dump show command and clear it.

Signed-off-by: Aya Levin <ayal@mellanox.com>
Acked-by: Jiri Pirko <jiri@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 tools/testing/selftests/drivers/net/netdevsim/devlink.sh |    9 +++++++++
 1 file changed, 9 insertions(+)

--- a/tools/testing/selftests/drivers/net/netdevsim/devlink.sh
+++ b/tools/testing/selftests/drivers/net/netdevsim/devlink.sh
@@ -431,6 +431,15 @@ dummy_reporter_test()
 
 	check_reporter_info dummy healthy 3 3 10 true
 
+	echo 8192> $DEBUGFS_DIR/health/binary_len
+	check_fail $? "Failed set dummy reporter binary len to 8192"
+
+	local dump=$(devlink health dump show $DL_HANDLE reporter dummy -j)
+	check_err $? "Failed show dump of dummy reporter"
+
+	devlink health dump clear $DL_HANDLE reporter dummy
+	check_err $? "Failed clear dump of dummy reporter"
+
 	log_test "dummy reporter test"
 }
 
