From: Jiri Pirko <jiri@mellanox.com>
Date: Thu, 21 Dec 2017 13:13:59 +0100
Subject: net: sched: fix possible null pointer deref in tcf_block_put
Patch-mainline: v4.15-rc6
Git-commit: 4853f128c13ed2731625dff2410b7fdbe540fb26
References: bsc#1109837

We need to check block for being null in both tcf_block_put and
tcf_block_put_ext.

Fixes: 343723dd51ef ("net: sched: fix clsact init error path")
Reported-by: Prashant Bhole <bhole_prashant_q7@lab.ntt.co.jp>
Signed-off-by: Jiri Pirko <jiri@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 net/sched/cls_api.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/net/sched/cls_api.c
+++ b/net/sched/cls_api.c
@@ -411,6 +411,8 @@ void tcf_block_put(struct tcf_block *blo
 {
 	struct tcf_block_ext_info ei = {0, };
 
+	if (!block)
+		return;
 	tcf_block_put_ext(block, block->q, &ei);
 }
 EXPORT_SYMBOL(tcf_block_put);
