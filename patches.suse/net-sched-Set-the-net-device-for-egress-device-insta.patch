From: Or Gerlitz <ogerlitz@mellanox.com>
Date: Wed, 18 Oct 2017 18:38:08 +0300
Subject: net/sched: Set the net-device for egress device instance
Patch-mainline: v4.15-rc1
Git-commit: 0843c092ee75bb375fbbb6b97a7c55e0069ae099
References: bsc#1109837

Currently the netdevice field is not set and the egdev instance
is not functional, fix that.

Fixes: 3f55bdda8df ('net: sched: introduce per-egress action device callbacks')
Signed-off-by: Or Gerlitz <ogerlitz@mellanox.com>
Acked-by: Jiri Pirko <jiri@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 net/sched/act_api.c |    1 +
 1 file changed, 1 insertion(+)

--- a/net/sched/act_api.c
+++ b/net/sched/act_api.c
@@ -1304,6 +1304,7 @@ tcf_action_egdev_get(const struct net_de
 	if (!egdev)
 		return NULL;
 	INIT_LIST_HEAD(&egdev->cb_list);
+	egdev->dev = dev;
 	tan = net_generic(dev_net(dev), tcf_action_net_id);
 	rhashtable_insert_fast(&tan->egdev_ht, &egdev->ht_node,
 			       tcf_action_egdev_ht_params);
