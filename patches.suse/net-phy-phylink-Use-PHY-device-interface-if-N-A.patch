From: Florian Fainelli <f.fainelli@gmail.com>
Date: Tue, 12 Dec 2017 16:00:26 -0800
Subject: net: phy: phylink: Use PHY device interface if N/A
Patch-mainline: v4.16-rc1
Git-commit: 4904b6ea1f9dbf47107f50b1c502a22d0160712d
References: bsc#1119113 FATE#326472

We may not always be able to resolve a correct phy_interface_t value before
actually connecting to the PHY device, when that happens, just have
phylink_connect_phy() utilize what the PHY device/driver provided.

Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/phy/phylink.c |    6 ++++++
 1 file changed, 6 insertions(+)

--- a/drivers/net/phy/phylink.c
+++ b/drivers/net/phy/phylink.c
@@ -716,6 +716,12 @@ int phylink_connect_phy(struct phylink *
 		     phy_interface_mode_is_8023z(pl->link_interface))))
 		return -EINVAL;
 
+	/* Use PHY device/driver interface */
+	if (pl->link_interface == PHY_INTERFACE_MODE_NA) {
+		pl->link_interface = phy->interface;
+		pl->link_config.interface = pl->link_interface;
+	}
+
 	ret = phy_attach_direct(pl->netdev, phy, 0, pl->link_interface);
 	if (ret)
 		return ret;
