From: "Paul E. McKenney" <paulmck@kernel.org>
Date: Thu, 2 Jan 2020 16:48:05 -0800
Subject: rcu: Provide debug symbols and line numbers in KCSAN runs
Patch-mainline: v5.7-rc1
Git-commit: 8a7e8f51714004112a0bbbf751f3dd0fcbbbc983
References: bsc#1171828

This commit adds "-g -fno-omit-frame-pointer" to ease interpretation
of KCSAN output, but only for CONFIG_KCSAN=y kerrnels.

Signed-off-by: Paul E. McKenney <paulmck@kernel.org>
Acked-by: Daniel Wagner <dwagner@suse.de>
---
 kernel/rcu/Makefile |    4 ++++
 1 file changed, 4 insertions(+)

--- a/kernel/rcu/Makefile
+++ b/kernel/rcu/Makefile
@@ -3,6 +3,10 @@
 # and is generally not a function of system call inputs.
 KCOV_INSTRUMENT := n
 
+ifeq ($(CONFIG_KCSAN),y)
+KBUILD_CFLAGS += -g -fno-omit-frame-pointer
+endif
+
 obj-y += update.o sync.o
 obj-$(CONFIG_TREE_SRCU) += srcutree.o
 obj-$(CONFIG_TINY_SRCU) += srcutiny.o
