From: Michal Kubecek <mkubecek@suse.cz>
Date: Sun, 14 Jun 2020 23:04:08 +0200
Subject: bpfilter: only build bpfilter_umh as static when BPFILTER_UMH=y
Patch-mainline: Not yet, under discussion
References: http://lkml.kernel.org/r/20200608115628.osizkpo76cgn2ci7@lion.mk-sys.cz

Conversion of bpfilter_umh build rules to userprogs accidentally dropped
the conditionals which only built it as a static binary when bpfilter_umh
was builtin so that now -static is used even if it's a module.

Restore the original behavior.

Fixes: 8a2cc0505cc4 ("bpfilter: use 'userprogs' syntax to build bpfilter_umh")
Signed-off-by: Michal Kubecek <mkubecek@suse.cz>
---
 net/bpfilter/Makefile | 2 ++
 1 file changed, 2 insertions(+)

--- a/net/bpfilter/Makefile
+++ b/net/bpfilter/Makefile
@@ -7,10 +7,12 @@ userprogs := bpfilter_umh
 bpfilter_umh-objs := main.o
 userccflags += -I $(srctree)/tools/include/ -I $(srctree)/tools/include/uapi
 
+ifeq ($(CONFIG_BPFILTER_UMH), y)
 # builtin bpfilter_umh should be linked with -static
 # since rootfs isn't mounted at the time of __init
 # function is called and do_execv won't find elf interpreter
 userldflags += -static
+endif
 
 $(obj)/bpfilter_umh_blob.o: $(obj)/bpfilter_umh
 
