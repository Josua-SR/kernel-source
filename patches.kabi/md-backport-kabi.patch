From: NeilBrown <neilb@suse.com>
Subject: Fix kabi for md backport
Patch-mainline: Never, kabi
References: bsc#1119680

The new fields are private to md, so they can be hidden from the kabi.

Acked-by: NeilBrown <neilb@suse.com>
Signed-off-by: Neil Brown <neilb@suse.com>
Signed-off-by: Coly Li <colyli@suse.de>
---
 drivers/md/md-cluster.h |    5 ++++-
 drivers/md/md.h         |   16 +++++++++++-----
 2 files changed, 15 insertions(+), 6 deletions(-)

--- a/drivers/md/md-cluster.h
+++ b/drivers/md/md-cluster.h
@@ -25,10 +25,13 @@ struct md_cluster_operations {
 	int (*remove_disk)(struct mddev *mddev, struct md_rdev *rdev);
 	void (*load_bitmaps)(struct mddev *mddev, int total_slots);
 	int (*gather_bitmaps)(struct md_rdev *rdev);
-	int (*resize_bitmaps)(struct mddev *mddev, sector_t newsize, sector_t oldsize);
 	int (*lock_all_bitmaps)(struct mddev *mddev);
 	void (*unlock_all_bitmaps)(struct mddev *mddev);
 	void (*update_size)(struct mddev *mddev, sector_t old_dev_sectors);
+
+#ifndef __GENKSYMS__
+	int (*resize_bitmaps)(struct mddev *mddev, sector_t newsize, sector_t oldsize);
+#endif
 };
 
 #endif /* _MD_CLUSTER_H */
--- a/drivers/md/md.h
+++ b/drivers/md/md.h
@@ -469,9 +469,6 @@ struct mddev {
 	 */
 	struct bio *flush_bio;
 	atomic_t flush_pending;
-	ktime_t start_flush, last_flush; /* last_flush is when the last completed
-					  * flush was started.
-					  */
 	struct work_struct flush_work;
 	struct work_struct event_work;	/* used by dm to report failure event */
 	void (*sync_super)(struct mddev *mddev, struct md_rdev *rdev);
@@ -479,6 +476,12 @@ struct mddev {
 	unsigned int			good_device_nr;	/* good device num within cluster raid */
 
 	bool	has_superblocks:1;
+
+#ifndef __GENKSYMS__
+	ktime_t start_flush, last_flush; /* last_flush is when the last completed
+					  * flush was started.
+					  */
+#endif
 };
 
 enum recovery_flags {
@@ -541,8 +544,6 @@ struct md_personality
 	 * requires md_thread should go into start()
 	 */
 	int (*run)(struct mddev *mddev);
-	/* start up works that require md threads */
-	int (*start)(struct mddev *mddev);
 	void (*free)(struct mddev *mddev, void *priv);
 	void (*status)(struct seq_file *seq, struct mddev *mddev);
 	/* error_handler must set ->faulty and clear ->in_sync
@@ -578,6 +579,11 @@ struct md_personality
 	int (*congested)(struct mddev *mddev, int bits);
 	/* Changes the consistency policy of an active array. */
 	int (*change_consistency_policy)(struct mddev *mddev, const char *buf);
+
+#ifndef __GENKSYMS__
+	/* start up works that require md threads */
+	int (*start)(struct mddev *mddev);
+#endif
 };
 
 struct md_sysfs_entry {
