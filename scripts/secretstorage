#! /usr/bin/python3
import sys
import re
import secretstorage as ss

if len(sys.argv) < 3:
    print("usage: {} service user".format(sys.argv[0]))
    sys.exit(1)

hre = re.compile(r"https?://(?P<api>[^/]*)")
m = hre.match(sys.argv[1])
if m:
    api = m.group("api")
else:
    api = sys.argv[1]


conn = ss.dbus_init()
coll = ss.get_default_collection(conn)
sess = coll.search_items({'service': api, 'username': sys.argv[2]})

for x in sess:
    print(x.get_secret().decode('utf-8'))
